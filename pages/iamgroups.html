<!DOCTYPE html>
<html>
<head>
<title>iamgroups.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="step-by-step-guide-to-creating-groups-with-the-iamgroups-web-service">Step-by-Step Guide to Creating Groups with the iamGroups Web Service</h1>
<p>This document provides information about the <a href="https://dir.api.it.umich.edu/docs/iamgroups/1/overview">iamGroups</a> Application Programming Interface (API). The iamGroups API is a web service that IT professionals can use to create and edit <a href="https://documentation.its.umich.edu/node/749">MCommunity groups</a>. This document assumes a basic understanding of the <a href="https://dir.api.it.umich.edu">U-M API Directory</a>. See the API Directory <a href="https://dir.api.it.umich.edu/get-started">Getting Started</a> page for more information.</p>
<h2 id="mcommunity-directory-basics">MCommunity Directory Basics</h2>
<p>The MCommunity Web Directory application allows for the management of user and group information. It is an application written in-house and supported by the Identity and Access Management team.</p>
<p>The purpose of the iamGroups web service is to allow you to do anything you can do with the Web Directory user interface.</p>
<p>The underlying database for the MCommunity Web Directory is an LDAP v3 compliant directory.</p>
<p>Users in the MCommunity directory (specifically, the MCommunity vault) are stored in <code>ou=People,dc=umich,dc=edu</code>, with a naming attribute of <code>uid</code>. The LDAP fully-qualified distinguished name of the user with the uniqname bjensen is <code>uid=bjensen,ou=People,dc=umich,dc=edu</code>.</p>
<p>Groups in the MCommunity directory are stored in <code>ou=User Groups,ou=Groups,dc=umich,dc=edu</code>, with a naming attribute of <code>cn</code> (common name). The LDAP fully-qualified distinguished name of a group with the name iamGroupsWSTest1 is <code>cn=iamGroupsWSTest1,ou=User Groups,ou=Groups,dc=umich,dc=edu</code>.</p>
<h2 id="api-directory-setup">API Directory Setup</h2>
<p>To call the iamGroups API, you will first need to join a team, create an app, subscribe to the iamGroups API, and obtain an API key. See the <a href="https://dir.api.it.umich.edu/get-started">Getting Started</a> guide for more information.</p>
<h2 id="setup-within-mcommunity">Setup within MCommunity</h2>
<p>After you subscribe to the iamGroups API, you will receive an API key. This API key should be added as an alias under the &quot;Also Known As” section of your MCommunity group.</p>
<p><img src="/files/AKA field update.png" alt="AKA Section of MCommunity groups"></p>
<p>For example, if the group you want to own your other groups is called FakeDepartment-Owners, you would add the API key as an alias under the “Also Known As” section of this group.</p>
<h2 id="active-directory-synchronization">Active Directory Synchronization</h2>
<p>If you are interested in synchronizing groups from MCommunity to Active Directory, please see <a href="https://docs.google.com/document/d/1AY5V6pinkLSfd8Wqs3ZxXh4tZVOBuLLnKcfA4YPicNM/edit?usp=sharing">Synchronizing Groups from MCommunity to AD</a> (Google doc) for additional configuration steps.</p>
<h2 id="programming-notes">Programming Notes</h2>
<ul>
<li>Data in POST request operations are always in JSON format.</li>
<li>If you are trying to automate group operations, you will need to append uniqnames and group names with the <code>ou=People,dc=umich,dc=edu</code> and <code>ou=User Groups,ou=Groups,dc=umich,dc=edu</code> organizational units.</li>
<li>The LDAP protocol is not case sensitive, so user and group fully-qualified distinguished names can appear in any combination of mixed case.</li>
</ul>
<h2 id="example-functionality">Example Functionality</h2>
<p>Any time you want to add or remove a member, owner, etc., you must first read the <code>memberDn</code> attribute with the <code>/members</code> endpoint, add or remove the user(s) from it, then call the desired endpoint with the updated list of users.</p>
<p>For example, the member, moderator, and owner endpoints have this requirement.</p>
<h3 id="find-information-for-a-group">Find information for a group</h3>
<p>Request method: <code>GET</code>
API endpoint: <code>/find/group/{Your Group Name}</code></p>
<p>This endpoint provides some, but not all, of the information for a group. For example, it does not provide the group's <code>gid</code> number. If you want to find the group's <code>gid</code> number, use the <code>/profile/dn</code> endpoint, described below.</p>
<h3 id="find-detailed-information-for-a-group">Find detailed information for a group</h3>
<p>Request method: <code>GET</code>
API endpoint: <code>/profile/dn/cn={Your Group Name},ou=User Groups,ou=Groups,dc=umich,dc=edu</code></p>
<p>This endpoint provides complete information for a group, including the group's <code>gid</code> number, which is located in the <code>gidNumber</code> attribute of the response.</p>
<h3 id="get-the-members-of-a-group">Get the members of a group</h3>
<p>Request method: GET
API endpoint: <code>/members/cn=Your Group Name,ou=User Groups,ou=Groups,dc=umich,dc=edu</code></p>
<p>Call this endpoint to get the members of the group from the memberDn attribute of the response.</p>
<h3 id="create-a-group">Create a group</h3>
<p>Request method: POST
API endpoint: <code>/api/create</code>
data: '{&quot;name&quot;:&quot;iamGroupsWSTest1&quot;}'</p>
<p>Your group will be created with an expiration date one year into the future.</p>
<h3 id="add-members-to-a-group">Add members to a group</h3>
<p>Request method: POST
API endpoint: <code>/update/member</code>
Request body:</p>
<pre class="hljs"><code><div>{
    <span class="hljs-attr">"dn"</span>: <span class="hljs-string">"cn=&lt;your group name&gt;,ou=user groups,ou=groups,dc=umich,dc=edu"</span>,
    <span class="hljs-attr">"memberDn"</span>: [
        <span class="hljs-string">"uid=&lt;uniqname&gt;,ou=people,dc=umich,dc=edu"</span>,
        <span class="hljs-string">"uid=&lt;uniqname&gt;,ou=people,dc=umich,dc=edu"</span>
    ]
}
</div></code></pre>
<p>This endpoint performs a replacement operation of the member attribute values.</p>
<h3 id="add-moderators-to-a-group">Add moderators to a group</h3>
<p>Request method: <code>POST</code><br>
API endpoint: <code>/update/moderator</code><br>
Request body:</p>
<pre class="hljs"><code><div>{
   <span class="hljs-attr">"dn"</span>:<span class="hljs-string">"cn=&lt;your group name&gt;,ou=user groups,ou=groups,dc=umich,dc=edu"</span>,
   <span class="hljs-attr">"moderator"</span>:[
      {
         <span class="hljs-attr">"email"</span>:<span class="hljs-string">"someone@google.com"</span>
      },
      {
         <span class="hljs-attr">"email"</span>:<span class="hljs-string">"someone@yahoo.com"</span>,
         <span class="hljs-attr">"name"</span>:<span class="hljs-string">"someone"</span>
      }
   ]
}
</div></code></pre>
<p>Do not try to add the name element without the email element, as this will not create a valid moderator value.</p>
<h3 id="add-owners-to-a-group">Add owners to a group</h3>
<p>Request method: POST
API endpoint: <code>/update/owner</code>
Request body:</p>
<pre class="hljs"><code><div>{
   <span class="hljs-attr">"dn"</span>:<span class="hljs-string">"cn=&lt;your group name&gt;,ou=user groups,ou=groups,dc=umich,dc=edu"</span>,
   <span class="hljs-attr">"ownerDn"</span>:[
      <span class="hljs-string">"cn=&lt;your group name&gt;,ou=user groups,ou=groups,dc=umich,dc=edu"</span>,
      <span class="hljs-string">"uid=uniqname,ou=people,dc=umich,dc=edu"</span>
   ]
}
</div></code></pre>
<h3 id="doing-more-with-the-swagger-document">Doing More with the Swagger Document</h3>
<p>You can use the Swagger document to do a lot more with the iamGroups API.</p>
<p>Swagger is a tool which allows our IAM developers to document the capabilities of the iamGroups API without having to maintain separate sets of code and documentation. The Swagger document for the iamGroups web service is <a href="https://dir.api.it.umich.edu/docs/iamgroups/1/overview">here</a>.</p>
<p>For example, if you wanted to find group members in a particular group, you would search the Swagger document for the word “member”. Then, you would expand the selection <code>/api/members/{dn}</code> in the document. The document tells you that this endpoint requires a GET request method, and it further tells you the type of data which it expects to be passed to it.</p>
<p>For example, to find a group:</p>
<p>Request method: <code>GET</code>
API endpoint: <code>members/cn=Your Group Name,ou=User Groups,ou=Groups,dc=umich,dc=edu</code></p>
<p>If you’re using the scripts included in this document, remember to use the <code>GET</code> script. Additionally, in the case of API endpoints, data is appended to the URL, so the value of the data must be URL-encoded.</p>
<p>If you were attempting to call the iamGroups API from a web browser, the URL would look like this:
<code>https://iam-groups-test.dsc.umich.edu/iamGroups/api/members/cn%3D%3Cyour%20group%20name%3E%2Cou%3Duser%20groups%2Cou%3Dgroups%2Cdc%3Dumich%2Cdc%3Dedu</code></p>

</body>
</html>
